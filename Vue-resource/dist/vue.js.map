{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototypel\r\n\r\n//不能直接改写数组原有方法  不可靠，因为只有被vue控制的数组才需要改写\r\n\r\nexport let arrayMethods = Object.create(Array.prototype)\r\n\r\nlet methods = [     //concat slice 都不能改变原数组\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',\r\n    'splice',\r\n    'reverse',\r\n    'sort'\r\n]\r\n\r\nmethods.forEach( method => {    //AOP切片编程\r\n    arrayMethods[method] = function (...args) {     //重写数组方法\r\n        console.log(\"数组变化\");\r\n        \r\n        //有可能用户新增的数据是对象格式  也需要进行拦截\r\n        let result = oldArrayProtoMethods[method].call(this, ...args);\r\n        let inserted;\r\n        switch(method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;\r\n                break;\r\n            case 'splice':  //splice(0, 1, xxx)\r\n                inserted = args.slice(2)\r\n            default:\r\n                break;\r\n        }\r\n        if(inserted) this.__ob__.observeArray(inserted);    //this指的是value\r\n        return result;\r\n     }\r\n} )","import { arrayMethods } from './array'\r\nclass Observer {\r\n    constructor(value) {     //需要对value属性重新定义\r\n\r\n        //value可能是对象， 可能是数组， 分类来处理\r\n        // value.__ob__ = this;    //this指的是Observer     这种方式会引起循环引用，换成Object.defineProperty  __ob__enumerable设置为不可枚举\r\n        Object.defineProperty(value, '__ob__', {\r\n            value: this,\r\n            enumerable:false,   //不能被枚举表示  不能被循环\r\n            configurable: false,   //补鞥呢删除此属性\r\n        })\r\n        if (Array.isArray(value)) {\r\n            //数组不用defineProperty类进行代理  性能不好\r\n\r\n            //push shift reverse sort pop unshift splice ...  重写数组的方法\r\n            Object.setPrototypeOf(value, arrayMethods);     //value.__proto__ = arrayMethods    vue的数组中，使用重写的方法，会先找改写后的（arrayMethods中的），若没有，在根据原型链查找Array上的\r\n            this.observeArray(value);       //处理原有数组中的对象\r\n        } else {\r\n            this.walk(value)\r\n        }\r\n    }\r\n    observeArray(value){\r\n        for(let i = 0 ; i <value.length ; i++){\r\n            observe(value[i]);\r\n        }\r\n    }\r\n    walk(data) {\r\n        Object.keys(data).forEach(key => {\r\n            defineReactive(data, key, data[key]);\r\n        })\r\n    }\r\n}\r\nexport function defineReactive(data, key, value) {  //vue2中数据嵌套不要过深， 过深浪费性能\r\n    //value可能也是个对象\r\n    if (typeof data !== 'object' || data == null) {\r\n        return;\r\n    }\r\n    observe(value);  //对结果递归拦截\r\n\r\n    Object.defineProperty(data, key, {\r\n        get() {\r\n            return value\r\n        },\r\n        set(newValue) {\r\n            if (newValue === value) return;\r\n            observe(newValue);      //如果用户设置的是一个对象  就继续讲用户设置的对象变成响应式的\r\n            value = newValue;\r\n        }\r\n    })\r\n}\r\nexport function observe(data) {\r\n    //只对对象类型进行观测，非对象类型无法观测\r\n    if (typeof data !== 'object' || data == null) {\r\n        return;\r\n    }\r\n    if(data.__ob__){    //防止循环引用\r\n        return;\r\n    }\r\n    //通过类实现对数据的观测  类可以方便扩展，会产生实例\r\n    return new Observer(data);\r\n}","import { observe } from './observe/index.js';\r\n\r\nexport function initState(vm) { \r\n    //将所有数据都定义在vm属性上，并且后续更改  需要触发视图更新\r\n    const opts = vm.$options;   //获取用户属性\r\n\r\n    if(opts.data){  //数据的初始化\r\n        initData(vm);\r\n    }\r\n}\r\n\r\nfunction proxy(vm, source, key){\r\n    Object.defineProperty(vm, key, {\r\n        get(){\r\n            return vm[source][key];\r\n        },\r\n        set(newValue){\r\n            vm[source][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm){\r\n    //数据劫持  Object.defineProperty\r\n    let data = vm.$options.data;\r\n    //对data类型进行判断  如果是函数  获取函数返回值作为对象\r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data;\r\n\r\n    //通过vm._data 获取劫持后的数据，用户就可以拿到_data了\r\n    //将_data中的数据全部放到vm上\r\n    for(let key in data){\r\n        proxy(vm, '_data', key) //vm.name => vm._data.name\r\n    }\r\n    //观测这个数据\r\n    observe(data);\r\n\r\n}","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\r\nconst attribute = /^\\s*([^s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\nconst startTagClose = /^\\s*(\\/?)>/;\r\nconst defaultTagRE = /\\{\\{(?:.|\\r?\\n)+?\\}\\}/g;\r\n\r\n\r\n//ast语法树\r\n\r\n\r\nexport function compileToFunctions(template) { \r\n    console.log(template);\r\n}","import { initState } from './state';\r\nimport { compileToFunctions } from './compiler/index.js';\r\nexport function initMixin(Vue) { \r\n    Vue.prototype._init = function(options){\r\n        const vm = this;\r\n        vm.$options = options;  //实例上有个属性$options  表示的是用户传入的所有属性\r\n        //初始化状态\r\n        initState(vm);\r\n\r\n        if(vm.$options.el) {    //数据可以挂载到页面上\r\n            vm.$mount(vm.$options.el);\r\n        }\r\n    }\r\n\r\n    Vue.prototype.$mount = function(el){\r\n        el = document.querySelector(el);\r\n        const vm = this;\r\n        const options = vm.$options;\r\n\r\n        if(!options.render){\r\n            let template = options.template;\r\n            if(!template&&el){\r\n                template = el.outerHTML\r\n            }\r\n            //如何将模板编译成render函数\r\n            const render = compileToFunctions(template);\r\n            options.render = render;\r\n        }\r\n    }\r\n}","import { initMixin } from './init';\r\n\r\nfunction Vue(options){\r\n    this._init(options);\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue;"],"names":["oldArrayProtoMethods","Array","prototypel","arrayMethods","Object","create","prototype","methods","forEach","method","console","log","args","result","call","inserted","slice","__ob__","observeArray","Observer","value","defineProperty","enumerable","configurable","isArray","setPrototypeOf","walk","i","length","observe","data","keys","key","defineReactive","get","set","newValue","initState","vm","opts","$options","initData","proxy","source","_data","compileToFunctions","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}